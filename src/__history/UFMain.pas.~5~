unit UFMain;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics, Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtDlgs, Vcl.ExtCtrls, Vcl.StdCtrls;

type
  TForm1 = class(TForm)
    IOrigin: TImage;
    OPD: TOpenPictureDialog;
    BGetGreyscale: TButton;
    IResult: TImage;
    procedure FormActivate(Sender: TObject);
    procedure IOriginDblClick(Sender: TObject);
    procedure BGetGreyscaleClick(Sender: TObject);
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

// Событие OnActivate выполняется в момент первой активации формы
procedure TForm1.BGetGreyscaleClick(Sender: TObject);
var
  Red, Green, Blue: array of array of byte;
  Y : array of array of real;
  N, M: word; // количество строк и столбцов в изображении
  i, j: word;
  Color: TColor;
  r, g, b: byte; // интенсивости составляющих в пиксле
begin
  N := IOrigin.Picture.Bitmap.Height;
  M := IOrigin.Picture.Bitmap.Width;
  SetLength(Red, N + 1); // +1 т.к. нумерация с 0
  SetLength(Green, N + 1); // +1 т.к. нумерация с 0
  SetLength(Blue, N + 1); // +1 т.к. нумерация с 0
  for i := 1 to N do
  begin
    SetLength(Red[i], M + 1);
    SetLength(Green[i], M + 1);
    SetLength(Blue[i], M + 1);
  end;
  for i := 1 to N do
    for j := 1 to M do
    begin
      Color := IOrigin.Canvas.Pixels[j - 1, i - 1];
      Red[i, j] := Color;
      Green[i, j] := Color shr 8;
      Blue[i, j] := Color shr 16;
      Y[i,j] := 0.299*Red[i,j] + 0.587*Green[i,j] + 0.114*Blue[i,j];
      Thresold:=20;
      if Round(Y[i,j])<Thresold then
      BI[i,j]:= false else BI[i,j]:=True;
    end;

  // TODO посмотри внимательно, как я объявил и сформировал массивы Red,Green,Blue. Твоя задача объявить массив Y и сформировать его

end;



procedure TForm1.FormActivate(Sender: TObject);
begin
  // IOrigin - название компонента на котором рисуем. Canvas - его "поле" для рисования
  IOrigin.Canvas.Pen.Color := clBlack;
  IOrigin.Canvas.Brush.Color := clWhite;
  IOrigin.Canvas.Brush.Style := bsSolid;
  // Рисуем прямоугольник. Начало координат в левом верхнем углу. Сначала указываем ширину, потом длину
  IOrigin.Canvas.Rectangle(0, 0, IOrigin.Width - 1, IOrigin.Height - 1);

  // Аналогично для результирующего изображения
  IResult.Canvas.Pen.Color := clBlack;
  IResult.Canvas.Brush.Color := clWhite;
  IResult.Canvas.Brush.Style := bsSolid;
  IResult.Canvas.Rectangle(0, 0, IResult.Width - 1, IResult.Height - 1);
end;

procedure TForm1.FormCreate(Sender: TObject);
begin

end;

// Событие, возникающее при двойном клике по области рисования
procedure TForm1.IOriginDblClick(Sender: TObject);
begin
  // Запускаем диалог открытия картинки и, если картинка была выбрана, загружаем её
  if OPD.Execute then
    IOrigin.Picture.LoadFromFile(OPD.FileName);
end;

end.
